#AI: ChatGPT 5 mini
name: Move caniuse data to regions

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  move-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Configure git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create branch for changes
        id: create_branch
        run: |
          BRANCH=move-caniuse-data-to-regions-$(date -u +"%Y%m%d%H%M%S")
          echo "branch=$BRANCH" >> $GITHUB_OUTPUT
          git checkout -b "$BRANCH"

      - name: Move files into regions (non-recursive)
        run: |
          set -eu
          DIR="UI_Demo/node_modules/caniuse-lite/data"
          mkdir -p "$DIR/regions"
          MOVED=0
          for f in "$DIR"/*; do
            [ -f "$f" ] || continue
            # skip the regions folder itself if it appears as a file
            if [ "$(basename "$f")" = "regions" ]; then
              continue
            fi
            echo "Moving: $f -> $DIR/regions/$(basename "$f")"
            git mv -v "$f" "$DIR/regions/$(basename "$f")" || mv "$f" "$DIR/regions/$(basename "$f")"
            MOVED=1
          done
          if [ "$MOVED" -eq 0 ]; then
            echo "No regular files to move in $DIR."
            exit 0
          fi

      - name: Commit and push changes
        run: |
          git add -A
          if git diff --cached --quiet; then
            echo "Nothing to commit"
            exit 0
          fi
          git commit -m "Move caniuse-lite data files into data/regions"
          git push --set-upstream origin HEAD

      - name: Create pull request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Move caniuse-lite data files into data/regions
          title: Move caniuse-lite data files into data/regions
          body: |
            This PR moves the files from UI_Demo/node_modules/caniuse-lite/data into
            UI_Demo/node_modules/caniuse-lite/data/regions as requested.
          # base omitted so the action will default to the repository default branch
